#{extends 'CRUD/layout.html' /}
#{set allowInsert:"${!blockInsert}" /}
#{set allowUpdate:"${!blockUpdate}" /}
#{set allowDelete:"${!blockDelete}" /}

<h2>&{'crud.list.title', type.name}</h2>
<div class="step">
    <div style="margin-top: 2em;">
        <label>&{'client'}:</label> <font>${invitation.respondent.userGroup.name}</font><br/>
        <label>&{'programId'}:</label> <font>${invitation.program.title}</font><br/>
        <label>&{'respondent'}:</label> <font>${invitation.respondent.name}</font><br/>
        <label>&{'startDate'}:</label> <font>${invitation.startDate.format('dd/MM/yyyy HH:mm:ss')}</font><br/>
        <label>&{'endDate'}:</label> <font>${invitation.endDate?.format('dd/MM/yyyy HH:mm:ss')}</font><br/>
    </div>
    <div>
        #{set surveyId: "null" /}
        #{set questionNumber: 0 /}
        #{list objects, as: 'object'}
            #{set aux: object.questionOption.question.survey.id /}
            #{if surveyId != aux}
                #{set surveyId: aux /}
                <div class="row" style="margin-top: 3em;">
                    <div class="col-md-12  mobile-hide">
                        <h2 style="font-size: 25px; margin: 0px;">&{object.questionOption.question.survey.name, questionNumber = 0}</h2>
                    </div>
                </div>
            #{/if}
            <div class="row" style="padding: 0px 25px;">
                <div class="col-md-12">
                    <h3 style="font-size: 20px;">
                        <span><b>${++questionNumber}</b> - &{object.questionOption.question.question}</span>
                    </h3>
                    <font class="button_fullwidth" style="cursor: default; font-size: 14px;">&{object.questionOption.option.option}</font>
                </div>
            </div>
            #{if object_isLast || aux != objects.get(object_index).questionOption.question.survey.id}
                <div class="row" style="padding: 0px 25px; margin-top: 2em;">
                    #{if object.questionOption.question.survey.surveyType.id == models.SurveyTypeBO.SurveyType.BURNOUT}
                        #{set burnoutServeyId: aux /}
                        <div class="col-md-12" style="background: rgba(199, 199, 199, 0.47); padding: 1em; border-radius: 5px 5px 0px 0px; box-shadow: 5px 5px 10px #888888;">
                            <label>&{'diagnosis'}:</label> <font>&{models.VwCountAnswerScoreBurnoutBO.findByInvitationIdAndSurveyId(invitation.id, burnoutServeyId).scoreClass.description}</font><br/>
                        </div>
                        <div id="parent_chart_id" class="col-md-12" style="background: #fff; padding: 1em; border-radius: 0px 0px 5px 5px; box-shadow: 5px 5px 10px #888888;">
                            <div class="table-responsive col-md-6" style="font-size: 14px;">
                                 <table class="table dataTable">
                                    <thead class="white-space-nowrap">
                                        <tr>
                                            <th style="width:95%;">&{'phases'}</th>
                                            <th style="text-align: center; padding-right: 8px;">&{'score.abr'}</th>
                                            <th style="text-align: center; padding-right: 8px;">&nbsp;</th>
                                            <th style="text-align: center; padding-right: 8px;">&{'maximum.abr'}</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tableScore_tbody" class="white-space-nowrap">
                                        <!-- Table body will come here -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <canvas id="radarChart" data-type="Radar" width="500" height="500"></canvas>
                            </div>
                        </div>
                    #{/if}
                    #{elseif object.questionOption.question.questionGroup != null}
                        <div class="col-md-12" style="background: rgba(199, 199, 199, 0.47); padding: 1em; border-radius: 5px; box-shadow: 5px 5px 10px #888888;">
                            <label>&{'general'}</label><br/>
                            <label style="margin-left: 1em;">&{'score'}:</label> <font>${models.VwCountAnswerScoreBO.findByInvitationIdAndSurveyId(object.invitation.id, aux)?.scoreAvg}</font><br/>
                            <label style="margin-left: 1em;">&{'diagnosis'}:</label> <font>&{models.VwCountAnswerScoreBO.findByInvitationIdAndSurveyId(object.invitation.id, aux).scoreClass.description}</font><br/>
                            #{list models.VwCountAnswerScoreGroupBO.findByInvitationIdAndSurveyId(invitation.id, aux), as: 'item'}
                                <br/>
                                <label>&{item.questionGroup.name}: &{item.questionGroup.description}</label><br/>
                                <label style="margin-left: 1em;">&{'score'}:</label> <font>${item.scoreAvg}</font><br/>
                                <label style="margin-left: 1em;">&{'diagnosis'}:</label> <font>&{item.scoreClass.description}</font><br/>
                            #{/list}
                        </div>
                    #{/elseif}
                    #{else}
                        <div class="col-md-12" style="background: rgba(199, 199, 199, 0.47); padding: 1em; border-radius: 5px; box-shadow: 5px 5px 10px #888888;">
                            <label>&{'score'}:</label> <font>${models.VwCountAnswerScoreBO.findByInvitationIdAndSurveyId(object.invitation.id, aux)?.score?.intValue()}</font><br/>
                            <label>&{'diagnosis'}:</label> <font>&{models.VwCountAnswerScoreBO.findByInvitationIdAndSurveyId(object.invitation.id, aux).scoreClass.description}</font><br/>
                        </div>
                    #{/else}
                </div>
            #{/if}
        #{/list}
    </div>
    <div class="row">
        <div class="col-md-12 add_bottom_30 btn-group" style="width: 100%; margin: 2em 0em; padding: 0px 25px;">
            <a href="@{index()}" class="button_medium" onclick="javascript: block();">&{'crud.back'}</a>
       </div>
    </div>
</div>

#{set 'moreScripts'}
    <script type="text/javascript" src="@{'/public/assets/chart.js/Chart.min.js'}"></script>
    <script type="text/javascript">
        #{if burnoutServeyId}
        
            var scoreAvgArray = [];
            var scoreMaxArray = [];
            var meanArray = [];
            var labelsArray = [
                "F1",
                "F2",
                "F3",
                "F4",
                "F5",
                "F6",
                "F7",
                "F8",
                "F9",
                "F10",
                "F11",
                "F12"
            ];
            
            #{set scoreAvgTotal: 0 /}
            #{list models.VwCountAnswerScoreGroupBO.findByInvitationIdAndSurveyId(invitation.id, burnoutServeyId), as: 'item'}
                ${scoreAvgTotal += item.scoreAvg}
                scoreAvgArray[${item_index - 1}] = ${item.scoreAvg};
                scoreMaxArray[${item_index - 1}] = ${item.maxScore};
        	    meanArray[${item_index - 1}] = 3.5;
        	    $("#tableScore_tbody").append(
                    '<tr>'
                        + '<td>&{"survey.burnout.table.group" + item_index}</td>'
                        + '<td style="width:10%; text-align: center;">${item.scoreAvg}</td>'
                        + '<td style="width:10%; text-align: center;">' + '${item.scoreAvg > 3.5 ? '<div class="ion-checkmark-round"></div>'.raw() : ''}' + '</td>'
                        + '<td style="width:10%; text-align: center;">${item.maxScore}</td>'
                  + '</tr>'
        	    );
            #{/list}
            $("#tableScore_tbody").append(
                '<tr>'
                    + '<td style="font-weight: bold;">&{"total.value"}</td>'
                    + '<td style="width:10%; text-align: center;">${scoreAvgTotal}</td>'
                    + '<td style="width:10%; text-align: center;">&nbsp;</td>'
                    + '<td style="width:10%; text-align: center;">&nbsp;</td>'
              + '</tr>'
            );
            	
            var data = {
                labels: labelsArray,
                datasets: [{
                        label: "&{'score'}",
                        fill: true,
                        tension: 0.0,
                        borderWidth: 3,
                        borderColor: "rgba(102, 160, 204, 1)",
                        backgroundColor: "rgba(102, 160, 204, 0.2)",
                        pointBackgroundColor: "rgba(102, 160, 204, 1)",
                        pointBorderColor: "#fff",
                        pointHoverBackgroundColor: "#fff",
                        pointHoverBorderColor: "rgba(102, 160, 204, 1)",
                        data: scoreAvgArray
                    }, {
                        label: "&{'maximum'}",
                        fill: false,
                        tension: 0.0,
                        borderColor: "rgba(232, 39, 39, 0)",
                        backgroundColor: "rgba(232, 39, 39, 0.7)",                       
                        pointBorderWidth: 5,
                        pointBackgroundColor: "rgba(232, 39, 39, 0.7)",
                        pointBorderColor: "rgba(232, 39, 39, 0.7)",
                        pointHoverBackgroundColor: "#fff",
                        pointHoverBorderColor: "rgba(232, 39, 39, 1)",
                        pointHoverBorderWidth: 7,
                        pointStyle: "triangle", // 'circle', 'triangle', 'rect', 'rectRot', 'cross', 'crossRot', 'star', 'line', 'dash'
                        data: scoreMaxArray
                    }, {
                        label: "&{'average'}",
                        fill: false,
                        borderWidth: 2,
                        backgroundColor: "#fff",
                        borderColor: "#000",
                        pointBackgroundColor: "#000",
                        pointBorderColor: "#fff",
                        pointHoverBackgroundColor: "#fff",
                        pointHoverBorderColor: "#000",
                        pointStyle: "line", // 'circle', 'triangle', 'rect', 'rectRot', 'cross', 'crossRot', 'star', 'line', 'dash',
                        borderDash: [8, 8],
                        data: meanArray
                    }
            ]};
                
            $(function() {
                // Global chart configs
                Chart.defaults.global.defaultFontFamily = '"Open Sans", Arial, sans-serif !important';
            	Chart.defaults.global.defaultFontSize = 12;
                Chart.scaleService.updateScaleDefaults('radialLinear', {
                    ticks: {
                        min: 1,
                        max: 6,
                        stepSize: 1,
                        fontSize: 12
                    }
                });
                
                var radarOptions = {
                    responsive: true,
                    lineArc: false,
                    legend: {
                        position: 'top',
                        display: true,
                      //  maintainAspectRatio: true,
                        labels: {
                        	fontFamily: "'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
                        	padding: 10,
                            fontColor: '#2d4050'
                        }
                    }
                };
                
                var ctx = $("#radarChart");
                new Chart(ctx, {
                    type: 'radar',
                    data: data,
                    options: radarOptions
                });
            });
        #{/if}
    </script>
#{/set}