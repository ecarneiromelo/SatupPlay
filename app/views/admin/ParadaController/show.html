#{extends 'CRUD/layout.html' /}
#{set allowInsert:"${!blockInsert}" /}
#{set allowUpdate:"${!blockUpdate}" /}
#{set allowDelete:"${!blockDelete}" /}

<h2>&{'crud.show.title', type.modelName}</h2>
<div class="step">
    <div id="middle-wizard">
        #{form action:@save(object._key()), enctype:'multipart/form-data'}
        <div id="map" class="col-md-12" style ="height:350px; margin: 15px 0px;"></div>
             #{crud.form}
            	#{crud.custom 'tbLinha'}
                    #{field 'object.tbLinha'}
	                    <div class="form-group ${field.errorClass ? 'has-error' : ''} text-left">
	                        <div class="styled-select">
	                            #{select field.name, value: field.value, id:field.id, class:'form-control fill-tooltip-grow', alt: play.i18n.Messages.get(field.name), title: play.i18n.Messages.get(field.name)}                    
	                                <option value="">&{'select.value.linha'}</option>     
	                                #{list items:models.LinhaBO.findAll(), as:'linha'}                                                                                             
	                                    <option name="${linha.dsNome}"}" value="${linha.id}" ${linha.equals(field.value) ? 'selected="true"'.raw() : ''}>&{linha.dsNome}</option>
	                                #{/list}  
	                            #{/select}                
	                            #{ifError field.name}
	                                <span id="helpBlock2" class="help-block">${field.error.raw()}</span>
	                            #{/ifError}
	                        </div>
	                    </div>
                    #{/field}
                #{/crud.custom}
            #{/crud.form}
            #{system.addCrudButtons /}
        #{/form}
    </div>
</div>
#{set 'moreScripts'}
 <script type="text/javascript">
 
 	var latLng = { -15.792982, -47.886226};
	var map;
    var markers = [];
    $(function(){
		map = new google.maps.Map(document.getElementById('map'), {
		  zoom: 15,
		  center: latLng
		});
      map.addListener('click', function(event) {
    	deleteMarkers()
        addMarker(event.latLng);
    	$('#object_dsPosicao').val(event.latLng.lat() +' , '+ event.latLng.lng())
      });
      addMarker('position');
    });
    function addMarker(location) {
      var marker = new google.maps.Marker({
        position: location,
        map: map
      });
      markers.push(marker);
    }

    function setMapOnAll(map) {
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);
      }
    }

    function clearMarkers() {
      setMapOnAll(null);
    }

    function showMarkers() {
      setMapOnAll(map);
    }

    function deleteMarkers() {
      clearMarkers();
      markers = [];
    }
    
 </script>
#{/set}
